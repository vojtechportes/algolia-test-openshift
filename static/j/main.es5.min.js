var detectMSIE=function(){/Edge\/|Trident\/|MSIE /.test(window.navigator.userAgent)&&$("body").addClass("b-msie")},flatten=function(e){var o={},s=function(e,t){if(Object(e)!==e)o[t]=e;else if(Array.isArray(e)){for(var a=0,n=e.length;a<n;a++)s(e[a],t?t+"."+a:""+a);0==n&&(o[t]=[])}else{var r=!0;for(var i in e)r=!1,s(e[i],t?t+"."+i:i);r&&(o[t]={})}};return s(e,""),o},setPager=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{nbPages:0,page:0,nbHits:0},a=arguments[2],n=$(e),r=n.find(".pager__count"),i=n.find(".pager__count-outof");return a.page+1<t.nbPages?a.page=a.page+1:a=!1,r.html(t.page+1),i.html(t.nbPages),a},loadItems=function(){if(0<$("[data-search-settings]").length){var s=["Delete","Insert","PageUp","PageDown","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End","Control","Alt","Tab"],c=["Escape"],f=function(s,c){var p=2<arguments.length&&void 0!==arguments[2]&&arguments[2],d=$(s),l=$(c.target),e=(d.find(".pager"),c.page),t=c.query;""!==t&&(t="?query="+t);var g=d.find(".template__item").html();g=$("<div/>").html(g).text(),l.empty(),$.ajax({url:"/api/v1/public/"+{"search_get-all":"search/getAllData","search_get-filtered":"search/getFilteredData"}[c.type]+"/"+e+t}).done(function(t){if("success"!==t.type)return function(e){throw new Error(t)}();var e,a,n,r=t.content.data.query,i=t.content.minData;if(t=t.content.data.hits,p){var o=setPager(".pager",i,c);o?$(".pager a").off("click.search.pager").on("click.search.pager",function(e){e.preventDefault();var t=s.parent().find(".listing__items-next"),a='.listing__items-next__item[data-page="'+o.page+'"]';t.append('<div class="listing__items-next__item" data-page="'+(o.page+1)+'" />'),o.target=a,f(d,o,p)}):$(".pager a").off("click.search.pager").parent().addClass("hide")}0===Object.keys(t).length?(l.empty(),l.append('<p class="no-results">Sorry, there are no items matching <em>'+r+"</em> :(</p>")):(Object.keys(t).forEach(function(e){var n=flatten(t[e]),r=g;c.fields.forEach(function(e){for(var t,a=new RegExp("({{"+e+"(?:||(.*?|}}))?}})","g");(t=a.exec(r))&&(r=void 0!==t[2]&&-1<t[2].indexOf("||")&&(""===n[e]||!1===n[e])?r.replace(t[0],t[2].replace("||","")):r.replace(t[0],n[e])),t;);}),l.append(r),e+1==0&&l.append('<div class="clearfix" />')}),e=l.find(".listing__item"),a=$(e),n=a.first(),$("body").on("keyup.search.navigate",function(e){"ArrowUp"===e.originalEvent.key?(e.preventDefault(),e.stopPropagation(),(n=0!==n.prev().length?n.prev():a.last()).find("a").focus()):"ArrowDown"===e.originalEvent.key&&(e.preventDefault(),e.stopPropagation(),(n=0!==n.next().length?n.next():a.first()).find("a").focus())}))}).fail(function(t){return function(e){throw new Error(t)}()})};$("[data-search-settings]").each(function(e,t){var a=$(t),n=a.data("search-settings"),r=n.inputMethod||"default",i=$(n.target),o=$(".backdrop");"type"===r?(o.on("click.search",function(e){$("body").removeClass("backdrop-active"),i.empty(),i.hide(),o.hide()}),$(n.inputTarget).on("keyup.search",function(e){var t=$(e.target).val();0===(n.query=t).length&&($("body").removeClass("backdrop-active"),i.empty(),i.hide(),o.hide()),0<t.length&&c.indexOf(e.originalEvent.key)?-1===s.indexOf(e.originalEvent.key)&&($("body").addClass("backdrop-active"),f(a,n),i.show(),o.show(),$("body").on("keyup.search",function(e){"Escape"===e.originalEvent.key&&($("body").removeClass("backdrop-active"),i.empty(),i.hide(),o.hide())})):(i.empty(),i.hide())})):a.hasClass("donotload")||f(a,n,!0)})}};detectMSIE(),loadItems();