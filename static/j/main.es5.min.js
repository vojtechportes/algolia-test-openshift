var detectMSIE=function(){/Edge\/|Trident\/|MSIE /.test(window.navigator.userAgent)&&$("body").addClass("b-msie")},flatten=function(e){var o={},i=function(e,a){if(Object(e)!==e)o[a]=e;else if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)i(e[t],a?a+"."+t:""+t);0==n&&(o[a]=[])}else{var s=!0;for(var r in e)s=!1,i(e[r],a?a+"."+r:r);s&&(o[a]={})}};return i(e,""),o},setPager=function(e){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{nbPages:0,page:0,nbHits:0},t=arguments[2],n=$(e),s=n.find(".pager__count"),r=n.find(".pager__count-outof");return t.page+1<a.nbPages?t.page=t.page+1:t=!1,s.html(a.page+1),r.html(a.nbPages),t},loadItems=function(){if(0<$("[data-search-settings]").length){var i=["Delete","Insert","PageUp","PageDown","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End","Control","Alt","Tab"],g=["Escape"],f=function(i,g){var c=2<arguments.length&&void 0!==arguments[2]&&arguments[2],l=$(i),d=$(g.target),e=(l.find(".pager"),g.page),a=g.query;g.key;""!==a&&(a="?query="+a);var p=l.find(".template__item").html();p=$("<div/>").html(p).text(),d.empty(),$.ajax({url:"/api/v1/public/"+{"search_get-all":"search/getAllData","search_get-filtered":"search/getFilteredData"}[g.type]+"/"+e+a}).done(function(a){if("success"!==a.type)return function(e){throw new Error(a)}();var e,t,n,s=a.content.data.query,r=a.content.minData;if(a=a.content.data.hits,c){var o=setPager(".pager",r,g);o?$(".pager a").off("click.search.pager").on("click.search.pager",function(e){e.preventDefault();var a=i.parent().find(".listing__items-next"),t='.listing__items-next__item[data-page="'+o.page+'"]';a.append('<div class="listing__items-next__item" data-page="'+(o.page+1)+'" />'),o.target=t,f(l,o,c)}):$(".pager a").off("click.search.pager").parent().addClass("hide")}0===Object.keys(a).length?(d.empty(),d.append('<p class="no-results">Sorry, there are no items matching <em>'+s+"</em> :(</p>")):(Object.keys(a).forEach(function(e){var n=flatten(a[e]),s=p;g.fields.forEach(function(e){for(var a,t=new RegExp("({{"+e+"(?:||(.*?|}}))?}})","g");(a=t.exec(s))&&(s=void 0!==a[2]&&-1<a[2].indexOf("||")&&(""===n[e]||!1===n[e])?s.replace(a[0],a[2].replace("||","")):s.replace(a[0],n[e])),a;);}),d.append(s)}),e=d.find(".listing__item"),t=$(e),n=t.first(),$("body").on("keyup.search.navigate",function(e){"ArrowUp"===e.originalEvent.key?(e.preventDefault(),e.stopPropagation(),(n=0!==n.prev().length?n.prev():t.last()).find("a").focus()):"ArrowDown"===e.originalEvent.key&&(e.preventDefault(),e.stopPropagation(),(n=0!==n.next().length?n.next():t.first()).find("a").focus())}))}).fail(function(a){return function(e){throw new Error(a)}()})};$("[data-search-settings]").each(function(e,a){var t=$(a),n=t.data("search-settings"),s=n.inputMethod||"default",r=$(n.target),o=$(".backdrop");"type"===s?(o.on("click.search",function(e){$("body").removeClass("backdrop-active"),r.empty(),r.hide(),o.hide()}),$(n.inputTarget).on("keyup.search",function(e){var a=$(e.target).val();0===(n.query=a).length&&($("body").removeClass("backdrop-active"),r.empty(),r.hide(),o.hide()),0<a.length&&g.indexOf(e.originalEvent.key)?-1===i.indexOf(e.originalEvent.key)&&($("body").addClass("backdrop-active"),f(t,n),r.show(),o.show(),$("body").on("keyup.search",function(e){"Escape"===e.originalEvent.key&&($("body").removeClass("backdrop-active"),r.empty(),r.hide(),o.hide())})):(r.empty(),r.hide())})):t.hasClass("donotload")||f(t,n,!0)})}},setLanguageSelector=function(){$(".language-selector--dropdown").off("click.language-selector").on("click.language-selector",function(e){e.preventDefault(),e.stopPropagation(),$(e.currentTarget).find(".language-selector__content").toggleClass("language-selector__content--opened")})},toggleMessage=function(){$(".toggle-message").off("click.toggle-message").on("click.toggle-message",function(e){console.log("click"),e.preventDefault(),e.stopPropagation();var a=$(e.currentTarget).closest(".message");a.hasClass("message--warning")?a.removeClass("message--warning").addClass("message--error"):a.hasClass("message--error")?a.removeClass("message--error").addClass("message--success"):a.hasClass("message--success")?a.removeClass("message--success").addClass("message--info"):a.hasClass("message--info")&&a.removeClass("message--info").addClass("message--warning")})};detectMSIE(),loadItems(),setLanguageSelector(),toggleMessage();